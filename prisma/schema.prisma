generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                             String                 @id @default(cuid())
  createdAt                      DateTime               @default(now())
  updatedAt                      DateTime               @updatedAt
  gender                         Gender?
  age                            Int?
  mobile                         String                 @unique
  village                        String?
  block                          String?
  district                       String?
  state                          String?
  pincode                        String?
  ayushmanCardAvailable          AyushmanCardStatus?
  customerConsent                Boolean                @default(false)
  termsAccepted                  Boolean                @default(false)
  dob                            DateTime?
  email                          String?                @unique
  first_name                     String                 @default("")
  guardian_name                  String?
  last_name                      String                 @default("")
  password                       String?
  role                           UserRoles              @default(CUSTOMER)
  is_self_registered             Boolean                @default(false)
  addressBooks                   AddressBook[]
  agent_created_user_entry       AgentCreatedUser?      @relation("agent_created_user")
  bandDetails                    BandDetails[]
  issued_cards                   BonchiCard[]           @relation("issued_cards")
  partner_bonchi_mitras_created  BonchiMitraPartner[]   @relation("bonchi_mitras_created_by_user")
  bonchi_mitra_partner           BonchiMitraPartner?    @relation("bonchi_mitra_partner_to_user")
  district_coordinator           DistrictCoordinator?   @relation("district_coordinator_to_user")
  health_assistant               HealthAssistant?       @relation("health_assistant_to_user")
  partner_hospitals_created      HospitalPartner[]      @relation("hospitals_partner_created_by_user")
  hospital_partner               HospitalPartner?       @relation("hospital_partner_to_user")
  partner_medical_stores_created MedicalStore[]         @relation("medical_stores_created_by_user")
  medical_store                  MedicalStore?          @relation("medical_store_to_user")
  operationSupportForms          OperationSupportForm[]
  payments                       Payment[]

  @@index([email])
  @@map("users")
}

model HealthAssistant {
  id               String    @id @default(cuid())
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt
  user_id          String    @unique
  date_of_birth    DateTime?
  gender           Gender?
  aadhaar_number   String?
  profession       String?
  qualification    String?
  specialization   String?
  experience_years Int?
  address          String?
  is_verified      Boolean   @default(false)
  status           String    @default("active")
  user             User      @relation("health_assistant_to_user", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("health_assistants")
}

model OperationSupportForm {
  id                         String        @id @default(cuid())
  created_at                 DateTime      @default(now())
  updated_at                 DateTime      @updatedAt
  user_id                    String
  patient_name               String
  age                        Int?
  gender                     Gender?       @default(OTHER)
  relationship               String?
  hospital_name              String?
  doctor_name                String?
  expected_surgery_date      DateTime?
  type_of_surgery            String?
  estimated_cost             Int?
  monthly_income             Int?
  number_of_dependents       Int?
  has_insurance              Boolean?      @default(false)
  required_support_percetage Int?
  additional_details         String?
  is_terms_accepted          Boolean       @default(false)
  status                     SupportStatus @default(PENDING)
  user                       User          @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("operation_support_forms")
}

model AddressBook {
  id                      String              @id @default(cuid())
  created_at              DateTime            @default(now())
  updated_at              DateTime            @updatedAt
  address_type            String?
  is_primary              Boolean             @default(false)
  full_address            String
  village_ward            String?
  area_locality           String?
  block                   String?
  district                String?
  state                   String?
  pincode                 String?
  hospital_partner_id     String?
  medical_store_id        String?
  bonchi_mitra_partner_id String?
  userId                  String?
  bonchi_mitra_partner    BonchiMitraPartner? @relation("bonchi_mitra_partner_addresses", fields: [bonchi_mitra_partner_id], references: [id], onDelete: Cascade)
  hospital_partner        HospitalPartner?    @relation("hospital_partner_addresses", fields: [hospital_partner_id], references: [id], onDelete: Cascade)
  medical_store           MedicalStore?       @relation("medical_store_addresses", fields: [medical_store_id], references: [id], onDelete: Cascade)
  user                    User?               @relation(fields: [userId], references: [id])

  @@index([hospital_partner_id])
  @@index([medical_store_id])
  @@index([bonchi_mitra_partner_id])
  @@map("address_book")
}

model BonchiCard {
  id              String    @id @default(cuid())
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  user_id         String
  card_number     String    @unique
  expiry_date     DateTime
  activation_date DateTime?
  status          String    @default("pending")
  user            User      @relation("issued_cards", fields: [user_id], references: [id], onDelete: Cascade)
  payments        Payment[]

  @@index([user_id])
  @@map("bonchi_cards")
}

model Payment {
  id             String      @id @default(cuid())
  created_at     DateTime    @default(now())
  user_id        String
  bonchi_card_id String?
  amount         Decimal     @db.Decimal(10, 2)
  currency       String      @default("INR")
  payment_id     String      @unique
  order_id       String?
  status         String
  payment_type   String
  bonchi_card    BonchiCard? @relation(fields: [bonchi_card_id], references: [id])
  user           User        @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([payment_id])
  @@map("payments")
}

model HospitalPartner {
  id                      String             @id @default(cuid())
  created_at              DateTime           @default(now())
  updated_at              DateTime           @updatedAt
  hospital_name           String
  email                   String?
  year_of_establishment   Int?
  alternate_mobile_number String?
  contact_person_name     String
  designation             String?
  diagnostic_discount     Int?
  free_services           String?
  hospital_types          HospitalType[]
  medical_services        MedicalService[]
  mobile_number           String
  opd_discount            Int?
  registration_number     String             @unique
  specialties             MedicalSpecialty[]
  specialty_other         String?
  surgery_discount        Int?
  user_id                 String             @unique
  created_by_user_id      String?
  is_self_registered      Boolean            @default(false)
  addresses               AddressBook[]      @relation("hospital_partner_addresses")
  created_by_user         User?              @relation("hospitals_partner_created_by_user", fields: [created_by_user_id], references: [id])
  user                    User               @relation("hospital_partner_to_user", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("hospital_partners")
}

model MedicalStore {
  id                         String        @id @default(cuid())
  created_at                 DateTime      @default(now())
  updated_at                 DateTime      @updatedAt
  user_id                    String        @unique
  created_by_user_id         String?
  store_name                 String
  owner_name                 String
  drug_license_number        String        @unique
  gst_number                 String?
  mobile_number              String
  alternate_mobile_number    String?
  email                      String?
  medicine_discount          Int?
  generic_medicine_discount  Int?
  home_delivery_available    Boolean       @default(false)
  bonchi_healthcard_accepted Boolean       @default(true)
  display_partner_board      Boolean       @default(true)
  drug_license_copy_url      String?
  store_photo_url            String?
  owner_aadhaar_pan_url      String?
  discount_agreement_consent Boolean       @default(false)
  insurance_understanding    Boolean       @default(false)
  terms_accepted             Boolean       @default(false)
  is_self_registered         Boolean       @default(false)
  addresses                  AddressBook[] @relation("medical_store_addresses")
  created_by_user            User?         @relation("medical_stores_created_by_user", fields: [created_by_user_id], references: [id])
  user                       User          @relation("medical_store_to_user", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("medical_stores")
}

model BonchiMitraPartner {
  id                            String             @id @default(cuid())
  created_at                    DateTime           @default(now())
  updated_at                    DateTime           @updatedAt
  user_id                       String             @unique
  created_by_user_id            String?
  aadhaar_number                String             @unique
  pan_number                    String             @unique
  live_photo_url                String?
  shop_photo_url                String?
  shop_centre_name              String
  business_types                BusinessType[]
  business_other                String?
  reporting_district_manager    String?
  agent_code                    String             @unique
  area_type                     AreaType?
  bank_account_holder_name      String
  bank_account_number           String
  bank_ifsc_code                String
  bank_name                     String
  upi_id                        String?
  agent_agreement_accepted      Boolean            @default(false)
  commission_structure_accepted Boolean            @default(false)
  data_privacy_consent          Boolean            @default(false)
  kyc_status                    KYCStatus          @default(PENDING)
  agent_status                  AgentStatus        @default(ACTIVE)
  is_self_registered            Boolean            @default(false)
  addresses                     AddressBook[]      @relation("bonchi_mitra_partner_addresses")
  created_users                 AgentCreatedUser[]
  transactions                  AgentTransaction[]
  wallet                        AgentWallet?
  created_by_user               User?              @relation("bonchi_mitras_created_by_user", fields: [created_by_user_id], references: [id])
  user                          User               @relation("bonchi_mitra_partner_to_user", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([agent_code])
  @@map("bonchi_mitra_partners")
}

model BandDetails {
  id                       String   @id @default(cuid())
  created_at               DateTime @default(now())
  updated_at               DateTime @updatedAt
  user_id                  String
  bank_account_holder_name String
  bank_account_number      String
  bank_ifsc_code           String
  bank_name                String
  upi_id                   String?
  user                     User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("band_details")
}

model DistrictCoordinator {
  id                 String      @id @default(cuid())
  created_at         DateTime    @default(now())
  updated_at         DateTime    @updatedAt
  user_id            String      @unique
  assigned_districts String[]
  employee_id        String?
  official_email     String?
  official_phone     String?
  status             AgentStatus @default(ACTIVE)
  user               User        @relation("district_coordinator_to_user", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("district_coordinators")
}

model AgentWallet {
  id                   String             @id @default(cuid())
  created_at           DateTime           @default(now())
  updated_at           DateTime           @updatedAt
  agent_id             String             @unique
  balance              Decimal            @default(0.00) @db.Decimal(10, 2)
  total_earned         Decimal            @default(0.00) @db.Decimal(10, 2)
  total_spent          Decimal            @default(0.00) @db.Decimal(10, 2)
  bonchi_mitra_partner BonchiMitraPartner @relation(fields: [agent_id], references: [id], onDelete: Cascade)

  @@index([agent_id])
  @@map("agent_wallets")
}

model AgentTransaction {
  id                   String             @id @default(cuid())
  created_at           DateTime           @default(now())
  agent_id             String
  transaction_type     String
  amount               Decimal            @db.Decimal(10, 2)
  description          String?
  reference_type       String?
  reference_id         String?
  balance_before       Decimal            @db.Decimal(10, 2)
  balance_after        Decimal            @db.Decimal(10, 2)
  performed_by         String?
  bonchi_mitra_partner BonchiMitraPartner @relation(fields: [agent_id], references: [id], onDelete: Cascade)

  @@index([agent_id])
  @@map("agent_transactions")
}

model AgentCreatedUser {
  id                   String             @id @default(cuid())
  created_at           DateTime           @default(now())
  agent_id             String
  user_id              String             @unique
  health_card_id       String?
  commission_amount    Decimal            @default(0.00) @db.Decimal(10, 2)
  status               String             @default("activated")
  bonchi_mitra_partner BonchiMitraPartner @relation(fields: [agent_id], references: [id], onDelete: Cascade)
  user                 User               @relation("agent_created_user", fields: [user_id], references: [id])

  @@index([agent_id])
  @@index([user_id])
  @@map("agent_created_users")
}

model AgentSettings {
  id                          String   @id @default(cuid())
  updated_at                  DateTime @updatedAt
  registration_fee            Decimal  @default(0.00) @db.Decimal(10, 2)
  card_activation_fee         Decimal  @default(100.00) @db.Decimal(10, 2)
  agent_commission_percentage Decimal  @default(10.00) @db.Decimal(5, 2)
  min_wallet_balance          Decimal  @default(0.00) @db.Decimal(10, 2)
  updated_by                  String?

  @@map("agent_settings")
}

model BannerImage {
  id         String   @id @default(cuid())
  created_at DateTime @default(now())
  url        String
  isActive   Boolean  @default(true)
  order      Int      @default(0)

  @@map("banner_images")
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum AyushmanCardStatus {
  YES
  NO
}

enum UserRoles {
  CUSTOMER
  BONCHI_MITRA
  HOSPITAL_PARTNER
  SUPER_ADMIN
  CUSTOMER
  BONCHI_MITRA
  HOSPITAL_PARTNER
  SUPER_ADMIN
  HEALTH_ASSISTANT
  MEDICAL_STORE
  DISTRICT_CORDINATOR
  DISTRICT_CORDINATOR
}

enum SupportStatus {
  PENDING
  APPROVED
  REJECTED
}

enum HospitalType {
  MULTISPECIALITY_HOSPITAL
  NURSING_HOME
  CLINIC
  DIAGNOSTIC_CENTRE
}

enum MedicalService {
  OPD_CONSULTATION
  IPD_ADMISSION
  SURGERY_OPERATION
  DIAGNOSTIC_PATHOLOGY
  EMERGENCY_SERVICES
}

enum MedicalSpecialty {
  MEDICINE
  SURGERY
  ORTHOPAEDIC
  GYNAECOLOGY
  PAEDIATRICS
  ENT
  EYE
  DENTAL
  OTHER
}

enum BusinessType {
  MOBILE_SHOP
  INTERNET_CENTRE
  CYBER_CAFE
  MEDICAL_STORE
  OTHER
}

enum AreaType {
  RURAL
  SEMI_URBAN
  URBAN
}

enum KYCStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum AgentStatus {
  ACTIVE
  HOLD
  DISABLED
}
